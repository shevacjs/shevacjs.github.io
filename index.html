<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>shevacjs home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="all about IT tech, football">
<meta property="og:type" content="website">
<meta property="og:title" content="shevacjs home">
<meta property="og:url" content="http://shevacjs.com/index.html">
<meta property="og:site_name" content="shevacjs home">
<meta property="og:description" content="all about IT tech, football">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="shevacjs home">
<meta name="twitter:description" content="all about IT tech, football">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  

</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo logo-text" href="/">Shevacjs</a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/categories">Categories</a>
        
          <a class="main-nav-link" href="/tags">Tags</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/atom.xml">Rss</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://shevacjs.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer">
      <article id="post-20180722" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/30/20180722/">weekly of 20180722</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/07/30/20180722/" class="article-date">
  <time datetime="2018-07-30T03:40:45.000Z" itemprop="datePublished">2018-07-30</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="工具技巧"><a href="#工具技巧" class="headerlink" title="工具技巧"></a>工具技巧</h3><ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwMzg1ODcwMw==&amp;mid=2247488140&amp;idx=1&amp;sn=a4397201d781386f854242d0ff5d2be8" target="_blank" rel="external">Facebook使用机器学习手段来自动优化其系统性能</a> : 没有完全理解文章的内容，现在的理解是，通过声明式的方式描述程序的逻辑，同时基于此，通过输入日志和反馈，调整程序的策略，进而优化整体的性能; 总感觉有点理想化~</li>
</ul>
<ul>
<li><p><a href="https://www.oschina.net/news/98255/facebook-open-source-oomd" target="_blank" rel="external">Facebook 开源 oomd，一种处理内存溢出的新方法</a> : <code>OOMD</code>也是一个<code>OOM</code>的处理工具，但是和传统的<code>OOM</code>工具不一样，其更会侧重优化和清理用户空间的内存，这样会保障整个内核和系统的相对稳健</p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzAwNzU3NzQ0MA==&amp;mid=2652089442&amp;idx=1&amp;sn=69bae21c50c779b8c0b995bd0c654e57&amp;chksm=809b066db7ec8f7b275b8a6f1ef792aace8a920c6c87dfe30fa401add813caa84929e4f420e0#rd" target="_blank" rel="external">大话计算机: 趣味了解浮点数</a> :  关于计算机浮点数机制的介绍，这本书的内容看目录还是非常不多的，先收藏mark</p>
</li>
<li><p><a href="https://emerentius.github.io/sudoku_web/" target="_blank" rel="external">Rust Sudoku Solver</a> : 作者用rust编写了一个Sudoku的解法器, 对于sudo的解决算法还是可以深入研究分析的, 先mark下，可以参考<a href="https://en.wikipedia.org/wiki/Sudoku_solving_algorithms" target="_blank" rel="external">Sudoku solving algorithms</a>, <a href="https://attractivechaos.wordpress.com/2011/06/19/an-incomplete-review-of-sudoku-solver-implementations/" target="_blank" rel="external">An Incomplete Review of Sudoku Solver Implementations</a></p>
</li>
<li><p><a href="http://tonsky.me/blog/dsl/" target="_blank" rel="external">Designing good DSL @ tonsky.me</a> : 设计新的<code>DSL</code>是我们解决一些复杂问题或者场景的一个有效方法，作者提出了真正要设计<code>DSL</code>的时候需要的一些注意点，包括<code>Make it verbose(不用用正则的奇怪的不容易理解的语法)</code>, <code>Don’t invent second syntax</code>等，不少意见值得采纳深思</p>
</li>
<li><p><a href="https://blog.ibireme.com/2015/11/02/mobile_image_benchmark/" target="_blank" rel="external">移动端图片格式调研 | Garan no dou</a> : 对于图片格式，以及其编解码速度的问题有一个非常系统的分析和对比，感觉可以关注的图片格式包括<code>APNG</code>,<code>BPG</code>, 但是直观上面感觉这两年发展不算快(2015年的文章)</p>
</li>
</ul>
<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><ul>
<li><p><a href="http://www.techug.com/post/meitun-deep-learning.html" target="_blank" rel="external">美团是如何基于深度学习实现图像的智能审核</a> : 两个值得关注的，一个是其审核的流程, 为”负例图片-&gt;正例图片-&gt;人审”, 这样可以保障业务迭代或者新增图片类型时，系统的健壮性；其次是其对于<code>水印检测</code>, <code>明星脸识别</code>, <code>色情图片检测</code>的策略优化，这个方面也有不少可借鉴的地方</p>
</li>
<li><p><a href="https://code.fb.com/data-infrastructure/xars-a-more-efficient-open-source-system-for-self-contained-executables/" target="_blank" rel="external">XARs: An efficient system for self-contained executables – Facebook Code</a> : </p>
</li>
</ul>
<h3 id="专题topic"><a href="#专题topic" class="headerlink" title="专题topic"></a>专题topic</h3><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><p><a href="https://zkp.science/" target="_blank" rel="external">What is a zero-knowledge proof? | Zero-Knowledge Proofs</a> : Mark, 关于<code>零和知识</code>的集中资料，先mark，找个周末再完整消化下</p>
</li>
<li><p><a href="https://github.com/hq6/GdbShellPipe" target="_blank" rel="external">GdbShellPipe: Enable piping of internal command output to external commands</a> : 一个 GDB的扩展，允许在 GDB 里面执行 shell 的命令, 比如说<code>shell-pipe disas | grep mov</code>可以检索出<code>disas</code>里面含有<code>mov</code>命令的语句</p>
</li>
<li><p><a href="https://stenci.la/" target="_blank" rel="external">Stencila</a>: “An open source office suite for reproducible research”, mark</p>
</li>
<li><p><a href="https://www.univocity.com/pages/html_parser_tutorial" target="_blank" rel="external">HTML parser : uniVocity data integration</a> : 一个开源的Java HTML解析器, 具有声明式语法, 自动内容下载的特性, mark关注了解下</p>
</li>
<li><p><a href="http://www.darkside.com.au/snow/" target="_blank" rel="external">The SNOW Home Page</a> : <code>SNOW</code>是一个通过增加在一些行末尾添加空格内容，以支持信息隐藏的一个手段, 甚至可以通过引入加密算法进行加密，使得即便此规则被泄露，依旧能进行信息隐藏和保护，其最后还有一个在线的<a href="http://fog.misty.com/perry/ccs/snow/snow/snow.html" target="_blank" rel="external">WEB DEMO</a>, 有兴趣可以试用下</p>
</li>
<li><p><a href="https://mwhittaker.github.io/blog/an_illustrated_proof_of_the_cap_theorem/" target="_blank" rel="external">An Illustrated Proof of the CAP Theorem</a> : 关于<code>CAP</code>原理的一个比较好的可视化演示和证明，可以关注下</p>
</li>
<li><p><a href="https://john-millikin.com/software/anansi" target="_blank" rel="external">Anansi: a NoWeb-inspired literate programming preprocessor</a> : Anansi是所谓的<code>文学编程</code>模式的预处理起，所谓<a href="https://zh.wikipedia.org/wiki/%E6%96%87%E5%AD%A6%E7%BC%96%E7%A8%8B" target="_blank" rel="external">文学编程</a>是相比于传统结构化编程的模式, 其可以让程序员在描述/书写文档的过程中完成对应的编码和文档说明(个人感觉这个模式效率其实是蛮低的)</p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMzg1ODcwMw==&amp;mid=2247488196&amp;idx=1&amp;sn=c5b243b9dc7bd7b3d44aab83aba820a7" target="_blank" rel="external">作为面试官，我是怎么快速判断程序员能力的？</a> : 对于如何做一个成功的面试的一些建议，还是非常接地气的；从我个人角度来看，『面试』这个事情，其实还是在于面试官对待面试的态度和准备，只有充分准备才能起到真正面试和完成合理判断</p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weekly/">weekly</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <article id="post-20180708" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/30/20180708/">weekly of 20180708</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/07/30/20180708/" class="article-date">
  <time datetime="2018-07-30T03:35:45.000Z" itemprop="datePublished">2018-07-30</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="工具技巧"><a href="#工具技巧" class="headerlink" title="工具技巧"></a>工具技巧</h3><ul>
<li><a href="https://arvid.io/2018/05/05/pdbs-on-linux/" target="_blank" rel="external">PDBs on Linux</a> : PDB是windows下面的符号文件，其可以和bin文件拆分，某些时候会便于调试；默认情况下, linux的ELF的文件其调试信息的耦合在bin里面的，作者给出了自己的办法，具体为(可以收藏):</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ objcopy --only-keep-debug a.out a.out.pdb <span class="comment"># extract symbols</span></div><div class="line">$ strip a.out <span class="comment"># strip away any debug information</span></div><div class="line">$ objcopy --add-gnu-debuglink=a.out.pdb a.out <span class="comment"># attach the symbols to the executable</span></div></pre></td></tr></table></figure>
<ul>
<li><p><a href="https://arvid.io/2018/06/30/on-cxx-random-number-generator-quality/" target="_blank" rel="external">On C++ Random Number Generator Quality</a> : 文章评估了C++lib下面随机数生成器的质量, 总结而已就是使用<a href="https://arvid.io/2018/06/30/on-cxx-random-number-generator-quality/" target="_blank" rel="external">PractRand</a>的方法评估, 可以持续关注; 另外推进作者的几篇不错的blog，包括<a href="https://arvid.io/2018/05/27/intel-microarchitectures-instruction-sets/" target="_blank" rel="external">Intel &amp; AMD Micro-Architecture Extended Instruction Sets</a>, <a href="https://arvid.io/2018/07/02/better-cxx-prng/" target="_blank" rel="external">Better C++ Pseudo Random Number Generator</a></p>
</li>
<li><p><a href="https://nullprogram.com/blog/2018/06/23/" target="_blank" rel="external">Intercepting and Emulating Linux System Calls with Ptrace « null program</a> : 深入ptrace的应用，其可以作为一个仿真器, 比如调用自定义的system call, 或者我们可以让其调用我们预定义的ABI</p>
</li>
</ul>
<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;mid=2247491177&amp;idx=1&amp;sn=756699190c00c5bc11113819bb57dec3" target="_blank" rel="external">谨防5个陷阱！数据科学家新手快速上道秘诀</a> : 最近<code>AI前线</code>给了不少实践落地的一些建议，这篇文章也是，有不少干货可以学习，具体包括:<ul>
<li>练习数据管理技能</li>
<li>研究不同模型的优缺点</li>
<li>尽可能简化模型</li>
<li>检查你结论中的因果关系和相关性</li>
<li>优化最有用的参数</li>
</ul>
</li>
</ul>
<ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIwMzg1ODcwMw==&amp;mid=2247488099&amp;idx=1&amp;sn=4b7ab3e5fd87d036e1deab2b1c0c9ecf" target="_blank" rel="external">Istio以及Service Mesh的未来</a> : 文章介绍<code>Istio</code>的简单机制，包括几个核心的组件:<code>Envoy</code>, <code>Pilot</code>,<code>Mixer</code>等，以及总结出来的其带来<code>灵活性</code>, <code>安全性</code>, <code>可观测性</code>等优点</li>
</ul>
<h3 id="专题topic"><a href="#专题topic" class="headerlink" title="专题topic"></a>专题topic</h3><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><p><a href="https://mp.weixin.qq.com/s/473mATiM1xnLUFKMD2FnnQ" target="_blank" rel="external">区块链的信任从何而来？</a> :  总而言之，就是用技术的手段，构建了一个大家认为『无法轻易作伪』的分布式存储系统，基于次可以构建更多的应用和业务</p>
</li>
<li><p><a href="https://www.theverge.com/2018/7/9/17549668/app-wikipedia-location-facts" target="_blank" rel="external">This app reads Wikipedia to teach you about the cities you’re driving through</a> : 作者开发了一个App，其可以通过地理位置信息，自动抓取Wikipedia上面的文章，推荐给用户(感觉是一个不错的产品玩法)</p>
</li>
<li><p><a href="https://github.com/rhysd/vim.wasm" target="_blank" rel="external">rhysd/vim.wasm: Vim editor ported to WebAssembly</a> : 将vim迁移到浏览器, 由于vim本身有不少UI交互上面的操作，因此直接编译源码到WASM并不可行，作者在blog里面也介绍了其思路, 通过disable适当的功能和构建合适的运行环境，值得学习</p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;mid=2247491444&amp;idx=1&amp;sn=47aa445f49de52316beaec40a776dbc7" target="_blank" rel="external">Hadoop老矣，为什么腾讯还要花精力在其开源发布上</a> : 可以理解为是对现在大数据生态现状的概述</p>
</li>
<li><p><a href="https://blog.acolyer.org/2018/07/05/enclavedb-a-secure-database-using-sgx/" target="_blank" rel="external">EnclaveDB: a secure database using SGX | the morning paper</a> : </p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weekly/">weekly</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <article id="post-nginx_1_15_2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/26/nginx_1_15_2/">nginx 1.15.2 版本说明</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/07/26/nginx_1_15_2/" class="article-date">
  <time datetime="2018-07-26T08:15:29.000Z" itemprop="datePublished">2018-07-26</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="0x00-Feature-List"><a href="#0x00-Feature-List" class="headerlink" title="0x00 Feature List"></a>0x00 Feature List</h2><p>主要包含如下两点: </p>
<ul>
<li><p>Feature: the $ssl_preread_protocol variable in the ngx_stream_ssl_preread_module.</p>
</li>
<li><p>Feature: now when using the “reset_timedout_connection” directive nginx will reset connections being closed with the 444 code.</p>
</li>
</ul>
<p>这里我们重点关注第二个特性(第一个特性，后续我们专门写篇介绍Nginx和SSL应用的文章再具体分析)</p>
<h2 id="0x01-Reset-Timeoutd-Connection"><a href="#0x01-Reset-Timeoutd-Connection" class="headerlink" title="0x01 Reset Timeoutd Connection"></a>0x01 Reset Timeoutd Connection</h2><p>第二个机制可以直译说明如下:</p>
<blockquote>
<p>如果开启<code>reset_timedout_connection</code>配置后，Ngnix接收<code>HTTP 444</code>状态码后，会重置对应的连接</p>
</blockquote>
<p>可以简单拆解为如下三个问题讨论:</p>
<ul>
<li>HTTP 444状态码的作用和目的</li>
<li>指令<code>reset_timedout_connection</code>的机制和作用</li>
<li>整体这个feature的作用</li>
</ul>
<h3 id="1-1-HTTP-444状态码"><a href="#1-1-HTTP-444状态码" class="headerlink" title="1.1 HTTP 444状态码"></a>1.1 HTTP 444状态码</h3><p>其实<code>444</code>是Nginx内部的状态码,从<a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html#return" target="_blank" rel="external">nginx return</a>的指令，看到说明如下:</p>
<blockquote>
<p>…The non-standard code 444 closes a connection without sending a response header …</p>
</blockquote>
<p>同时<a href="https://httpstatuses.com/444" target="_blank" rel="external">Http Status</a>网站也有详细说明, 如下: </p>
<blockquote>
<p>A non-standard status code used to instruct nginx to close the connection without sending a response to the client, most commonly used to deny malicious or malformed requests.</p>
</blockquote>
<p>这样就比较明确, HTTP 444是Nginx内部的状态码, 其主要是作用是告诉 nginx可以直接关闭对应的链接，无需发送响应头部。这可以有效处理恶意或者畸形的流量。</p>
<h3 id="1-2-reset-timedout-connection指令"><a href="#1-2-reset-timedout-connection指令" class="headerlink" title="1.2 reset_timedout_connection指令"></a>1.2 reset_timedout_connection指令</h3><p>该指令是由<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#reset_timedout_connection" target="_blank" rel="external">ngx_http_core_module</a>提供的，如下是官方的说明:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">* Syntax:   reset_timedout_connection on | off;</div><div class="line">* Default:	reset_timedout_connection off;</div><div class="line">* Context:	http, server, location</div><div class="line"></div><div class="line">Enables or disables resetting timed out connections. The reset is performed as follows. Before closing a socket, the SO_LINGER option is set on it with a timeout value of 0. When the socket is closed, TCP RST is sent to the client, and all memory occupied by this socket is released. This helps avoid keeping an already closed socket with filled buffers in a FIN_WAIT1 state for a long time.</div></pre></td></tr></table></figure>
<p>简而言之, 当开启<code>reset_timedout_connection</code>后，Nginx 会通过设置<code>SO_LINGER</code>的选项快速关闭超时的连接, 其作用是保障系统和 Nginx 能够快速释放无用的连接的资源。 具体实现上面，就是通过控制<code>SO_LINGER</code>选项。</p>
<p>关于<a href="https://notes.shichao.io/unp/ch7/#so_linger-socket-option" target="_blank" rel="external">SO_LINGER</a>其作用，可以简述为是控制<code>close</code>的行为, 参考<a href="http://blog.51cto.com/xwandrew/2046615" target="_blank" rel="external">Linux Socket SO_LINGER选项
</a>(个人感觉解释的比较清晰明了)的说明，可以简述如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//SO_LINGER选项有如下结构：</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">linger</span> &#123;</span></div><div class="line">     <span class="keyword">int</span> l_onoff; <span class="comment">/* 0 = off, nozero = on */</span></div><div class="line">     <span class="keyword">int</span> l_linger; <span class="comment">/* linger time */</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>当设置 l_onoff为1，l_linger为0，则连接立即终止，TCP将丢弃残留在发送缓冲区中的数据并发送一个RST给对方，而不是通常的四分组终止序列，这避免了TIME_WAIT状态；在远端的recv()调用将以WSAECONNRESET出错。</p>
<p>这个也是Nginx的默认行为如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// file: ngx_http_request.c, 快速关闭请求</span></div><div class="line"><span class="keyword">if</span> (clcf-&gt;reset_timedout_connection) &#123;</div><div class="line">    linger.l_onoff = <span class="number">1</span>;</div><div class="line">    linger.l_linger = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (setsockopt(r-&gt;connection-&gt;fd, SOL_SOCKET, SO_LINGER,</div><div class="line">                    (<span class="keyword">const</span> <span class="keyword">void</span> *) &amp;linger, <span class="keyword">sizeof</span>(struct linger)) == <span class="number">-1</span>)</div><div class="line">    &#123;</div><div class="line">        ngx_log_error(NGX_LOG_ALERT, <span class="built_in">log</span>, ngx_socket_errno,</div><div class="line">                        <span class="string">"setsockopt(SO_LINGER) failed"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="1-3-整体-Feature-作用"><a href="#1-3-整体-Feature-作用" class="headerlink" title="1.3 整体 Feature 作用"></a>1.3 整体 Feature 作用</h3><p>如上，整体的作用其实就是让 Nginx <a href="http://mailman.nginx.org/pipermail/nginx-devel/2018-July/011271.html" target="_blank" rel="external">能够快速释放相关的资源</a>, 如下是前后的流程对比</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//before</span></div><div class="line">A  +---------&gt;  B +--------&gt;  C</div><div class="line"></div><div class="line">                  <span class="number">1.</span> <span class="keyword">return</span> <span class="number">444</span></div><div class="line">                &lt;-----------+</div><div class="line"></div><div class="line">     <span class="number">2.</span>normal close</div><div class="line">   &lt;------------+</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//now</span></div><div class="line">A  +---------&gt;  B +--------&gt;  C</div><div class="line"></div><div class="line"></div><div class="line">  <span class="number">2.</span> reset socket  <span class="number">1.</span> <span class="keyword">return</span> <span class="number">444</span></div><div class="line"> &lt;-----------+  &lt;-----------+</div></pre></td></tr></table></figure>
<h2 id="0x02-Nginx-模块的执行顺序"><a href="#0x02-Nginx-模块的执行顺序" class="headerlink" title="0x02 Nginx 模块的执行顺序"></a>0x02 Nginx 模块的执行顺序</h2><p>算是这次的补充说明, 是好久之前追查的一个问题，才发现之前对 Nginx 模块的执行顺序一直理解有误，这边记录说明下。</p>
<p>我们知道nginx的一个状态机驱动的模型, 那么在同一个阶段（状态）下面, 模块的执行顺序如何呢? 具体结论如下:</p>
<p>在非 filter 模块情况下, <code>在configure的时候, 越晚添加的模块就会越先执行(挂载在同一阶段的模块哈)</code>, 几个注意点如下:</p>
<ol>
<li><p>上面描述的是在<code>configure</code>阶段越晚添加的越先执行, 指的是 Nginx 默认的configure，由于一些产品线的nginx 都会包一层自己的编译处理逻辑，这个时候就需要关注其是如何新增模块的(也就是新增模块和真正 configure)的关系</p>
</li>
<li><p>Nginx扩展的自己<code>config</code>也会影响或者控制模块的执行顺序，默认的config如下:</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HTTP_AUX_FILTER_MODULES=<span class="string">"<span class="variable">$HTTP_AUX_FILTER_MODULES</span> ngx_http_baidu_problem_tracing_module"</span></div></pre></td></tr></table></figure>
<p>但是如果改写成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HTTP_AUX_FILTER_MODULES=&quot;ngx_http_baidu_problem_tracing_module $HTTP_AUX_FILTER_MODULES &quot;</div></pre></td></tr></table></figure>
<p>原因具体下面说明;</p>
<p>现在我们来看一个模块/扩展是如何接入 Nginx 的状态机的;</p>
<p>1. configure阶段, 这个过程，Nginx 的脚本通过我们的编译控制，收集相关的信息，最终会生成一个 Shell 变量，这个变量包含了我们要编译进去的所有模块名称，如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> [ <span class="variable">$HTTP</span> = YES ]; <span class="keyword">then</span></div><div class="line">    modules=<span class="string">"<span class="variable">$modules</span> <span class="variable">$HTTP_MODULES</span> <span class="variable">$HTTP_FILTER_MODULES</span> \</span></div><div class="line">             <span class="variable">$HTTP_HEADERS_FILTER_MODULE</span> \</div><div class="line">             <span class="variable">$HTTP_AUX_FILTER_MODULES</span> \</div><div class="line">             <span class="variable">$HTTP_COPY_FILTER_MODULE</span> \</div><div class="line">             <span class="variable">$HTTP_RANGE_BODY_FILTER_MODULE</span> \</div><div class="line">             <span class="variable">$HTTP_NOT_MODIFIED_FILTER_MODULE</span>"</div><div class="line"></div><div class="line">    NGX_ADDON_DEPS=<span class="string">"<span class="variable">$NGX_ADDON_DEPS</span> \$(HTTP_DEPS)"</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<p>这个里面需要说明的一点是module是直接引用了<code>$HTTP_AUX_FILTER_MODULES</code>之类的变量，而这些变量是每个扩展的<code>config</code>文件自己控制的，也就是说你把变量名字写在前后，直接影响你在<code>modules</code>里面的顺序</p>
<ol>
<li>代码生成阶段，通过如上的环境变量, Nginx会生成类似于如下的文件, </li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">ngx_module_t</span> *ngx_modules[] = &#123;</div><div class="line">    &amp;ngx_core_module,</div><div class="line">    &amp;ngx_errlog_module,</div><div class="line">    &amp;ngx_conf_module,</div><div class="line">    &amp;ngx_events_module,</div><div class="line">    &amp;ngx_event_core_module,</div><div class="line">    &amp;ngx_epoll_module,</div><div class="line">    &amp;ngx_openssl_module,</div><div class="line">    &amp;ngx_regex_module,</div><div class="line">    &amp;ngx_http_module,</div><div class="line">    &amp;ngx_http_core_module,</div><div class="line">    &amp;ngx_http_log_module,</div><div class="line">    &amp;ngx_http_upstream_module,</div><div class="line">    &amp;ngx_http_static_module,</div><div class="line">    &amp;ngx_http_autoindex_module,</div><div class="line">    &amp;ngx_http_index_module,</div><div class="line">    <span class="comment">/* 这里说明 access 是 auth basic 在 access 阶段先执行的 */</span></div><div class="line">    &amp;ngx_http_auth_basic_module,</div><div class="line">    &amp;ngx_http_access_module,</div><div class="line">    </div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>启动初始化阶段, 其在<code>http/ngx_http.c</code>会有大概如下的伪代码:</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//file: http/ngx_http.c</span></div><div class="line">        n += cmcf-&gt;phases[i].handlers.nelts;</div><div class="line"></div><div class="line"><span class="comment">// 从后面开始，追加到对于ph里面; 也就是越早在ngx modules里面被引用的，在会放在ph的越前面</span></div><div class="line">        <span class="keyword">for</span> (j = cmcf-&gt;phases[i].handlers.nelts - <span class="number">1</span>; j &gt;=<span class="number">0</span>; j--) &#123;</div><div class="line">            ph-&gt;checker = checker;</div><div class="line">            ph-&gt;handler = h[j];</div><div class="line">            ph-&gt;next = n;</div><div class="line">            ph++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> NGX_OK;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>执行阶段如下:</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ngx_http_core_run_phases</span><span class="params">(<span class="keyword">ngx_http_request_t</span> *r)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">ngx_int_t</span>                   rc;</div><div class="line">    <span class="keyword">ngx_http_phase_handler_t</span>   *ph;</div><div class="line">    <span class="keyword">ngx_http_core_main_conf_t</span>  *cmcf;</div><div class="line"></div><div class="line">    cmcf = ngx_http_get_module_main_conf(r, ngx_http_core_module);</div><div class="line"></div><div class="line">    ph = cmcf-&gt;phase_engine.handlers;</div><div class="line"></div><div class="line">    <span class="comment">// 顺序执行</span></div><div class="line">    <span class="keyword">while</span> (ph[r-&gt;phase_handler].checker) &#123;</div><div class="line"></div><div class="line">        rc = ph[r-&gt;phase_handler].checker(r, &amp;ph[r-&gt;phase_handler]);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (rc == NGX_OK) &#123;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如上，可以明确: </p>
<blockquote>
<p>在非filter 模块情况下, 在configure的时候, 越晚添加的模块就会越先执行(挂载在同一阶段的模块哈)</p>
</blockquote>
<h2 id="0x03-Reference"><a href="#0x03-Reference" class="headerlink" title="0x03 Reference"></a>0x03 Reference</h2><ul>
<li><p><a href="https://forum.nginx.org/read.php?2,246978,246999" target="_blank" rel="external">Re: How to control the order of execution modules in nginx</a></p>
</li>
<li><p><a href="http://blog.aka-cool.net/blog/2014/03/06/nginx-module-execute-order-in-same-phrase/" target="_blank" rel="external">挂载在同一阶段的Nginx模块的执行顺序 - Aka.Why</a> : 重点参考该作者的分析</p>
</li>
<li><p><a href="https://item.jd.com/29369702559.html" target="_blank" rel="external">深入理解Nginx：模块开发与架构解析-第2版</a> : 里面有重点介绍 nginx的<code>configure</code>的执行过程</p>
</li>
<li><p><a href="https://www.kancloud.cn/kancloud/master-nginx-develop/51904" target="_blank" rel="external">模块编译顺序 · Nginx开发从入门到精通 · 看云</a> : 大部分内容都是 OK 的,但是关于<code>HTTP MODULE</code>的论述有些问题，可以选择性了解下</p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <article id="post-nginx_1_15_1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/17/nginx_1_15_1/">nginx 1.15.1 版本说明</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/07/17/nginx_1_15_1/" class="article-date">
  <time datetime="2018-07-17T08:50:29.000Z" itemprop="datePublished">2018-07-17</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Feature-List"><a href="#Feature-List" class="headerlink" title="Feature List"></a>Feature List</h2><p>主要包含如下两点: </p>
<ul>
<li><p>Feature: the “random” directive inside the “upstream” block.</p>
</li>
<li><p>Feature: improved performance when using the “hash” and “ip_hash” directives with the “zone” directive.</p>
</li>
</ul>
<p>一个是引入了<code>random</code>的upstream机制，还有一个是优化了<code>zone</code>区的<code>hash</code>性能; 下面我们详细拆解其功能</p>
<h2 id="Upstream-Zone机制"><a href="#Upstream-Zone机制" class="headerlink" title="Upstream Zone机制"></a>Upstream Zone机制</h2><p>Nginx在<code>1.9.0</code>版本引入了<a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#zone" target="_blank" rel="external">zone</a>的机制, 官方手册说明如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">* Syntax:    zone name [size];</div><div class="line">* Default:    —</div><div class="line">* Context:    upstream</div><div class="line">&gt; This directive appeared in version 1.9.0.</div><div class="line"></div><div class="line">Defines the name and size of the shared memory zone that keeps the group’s configuration and run-time state that are shared between worker processes.</div></pre></td></tr></table></figure>
<p>也就是其核心能力是使得upstream的相关配置以及状态，支持在进程间共享。这方面的优势显而易见，依照<a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/#zone" target="_blank" rel="external">NGINX Load Balancing - HTTP Load Balancer
</a>说明，我们可以总结为:</p>
<ul>
<li><p>其可以方便的支持健康检查,动态upstream配置等，而无需担心多进程数据同步的问题</p>
</li>
<li><p>状态数据，比如<code>max_fail</code>等信息，可以被多个进程共享，这样是的业务避免无效的请求和重试, 否则每个进程都得去触发<code>max_fail</code>之类的阈值</p>
</li>
</ul>
<p>关于upstream zone另外一个可以关注的点是其<code>实现机制</code>。直观来看的话，从单进程到多进程共享的数据结构，可能对源码会有较大的改动，尤其是有不少现存的upstream module,  不过nginx引入了一个相对巧妙的机制, 可以通过<code>ngx_http_upstream_zone_module.c</code>了解，其核心思路是: </p>
<ol>
<li>将进程内的数据拷贝到共享内存里面</li>
<li>将所有的指针指向共享内存空间</li>
</ol>
<p>这样<code>几乎</code>(主要有时候还需要解决多进程并发读写的问题)可以透明的将数据迁移到共享内存里面; 大致代码如下:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> ngx_int_t</span></div><div class="line"><span class="title">ngx_http_upstream_init_zone</span><span class="params">(<span class="keyword">ngx_shm_zone_t</span> *shm_zone, <span class="keyword">void</span> *data)</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">size_t</span>                          len;</div><div class="line">    <span class="keyword">ngx_uint_t</span>                      i;</div><div class="line">    <span class="keyword">ngx_slab_pool_t</span>                *shpool;</div><div class="line">    <span class="keyword">ngx_http_upstream_srv_conf_t</span>   *uscf, **uscfp;</div><div class="line">    <span class="keyword">ngx_http_upstream_main_conf_t</span>  *umcf;</div><div class="line"></div><div class="line">    <span class="comment">/* 省去部分代码，指向共享内存区域 */</span></div><div class="line">    shpool = (<span class="keyword">ngx_slab_pool_t</span> *) shm_zone-&gt;shm.addr;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/* copy peers to shared memory */</span></div><div class="line"></div><div class="line">    umcf = shm_zone-&gt;data;</div><div class="line">    uscfp = umcf-&gt;upstreams.elts;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; umcf-&gt;upstreams.nelts; i++) &#123;</div><div class="line">        uscf = uscfp[i];</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (uscf-&gt;shm_zone != shm_zone) &#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/* 讲每个upstream conf 拷贝到共享内存区域 */</span></div><div class="line">        <span class="keyword">if</span> (ngx_http_upstream_zone_copy_peers(shpool, uscf) != NGX_OK) &#123;</div><div class="line">            <span class="keyword">return</span> NGX_ERROR;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> NGX_OK;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>所以回到这次的feature, 对所谓的『ip_hash/hash』的性能优化，其实就是对zone里面读写锁的精细化控制。</p>
<h2 id="Random-Upstream"><a href="#Random-Upstream" class="headerlink" title="Random Upstream"></a>Random Upstream</h2><p>另外一个比较大的特性是引入<a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#random" target="_blank" rel="external">random upstream</a>的支持, 其官方手册说明如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">* Syntax:	random [two [method]];</div><div class="line">* Default:	—</div><div class="line">* Context:	upstream</div><div class="line"></div><div class="line">The optional two parameter instructs nginx to randomly select two servers and then choose a server using the specified method. The default method is least_conn which passes a request to a server with the least number of active connections.</div></pre></td></tr></table></figure>
<p>这里我们主要关注<code>random two least_conn</code>的情况; 什么意思呢?</p>
<p>用随机算法的时候，我们最担心的就是随机不均衡的问题, 所以对于我们upstream的random算法，其也要考虑这个方面的情况, 而<code>two least_conn</code>就是处理这个问题的有效手段，下面具体分析。</p>
<p>首先回到一个纯粹的数学问题，N个请求让N个服务器处理，则处理请求最多的服务器其会处理多少请求呢？</p>
<p>我们知道正常情况下，平均一个服务器会处理一个请求，但是事实上这个是低概率事件, 从<a href="https://homes.cs.washington.edu/~karlin/papers/balls.pdf" target="_blank" rel="external">Balanced Allocations</a>的分析，其原话是:</p>
<blockquote>
<p>the fullest box has, with high probability, ln $n$ / ln ln $n(1 + o(1))$ ball in it</p>
</blockquote>
<p>也就是其实最大负载的机器其处理的请求数会远超于均值, 而如果用<code>Two Random Choices</code>(随机选两个，其次选择负载低的策略), 其概率大概为 $ln \ ln\ n$</p>
<p>如下是去概率函数分布图: </p>
<p><img src="/images/two-choice-info.svg" alt="two-random-choice"></p>
<p>总而言之, 双次选择会使得我们的负载均衡的表现更为优异。</p>
<p>如上公式的数学推导其实是比较复杂的(至少我没有看懂), 所以这里在简单分享自己对”N个请求让N个服务器处理，则处理请求最多的服务器其会处理多少请求呢?”这个问题的程序员解法;(Maybe有错误哈)</p>
<p>首先定义概率密度函数:</p>
<ul>
<li>$f(k)$ : 表示N个球放N个盒子,处理请求最多的盒子其处理请求数量为k的概率</li>
<li>则上面的问题，其实求的就是该分布的期望, 可以有:</li>
</ul>
<p>$$E = \sum_{k=1}^{n}{f(k)*k}$$</p>
<p>其次，我们分析如何求解$f(k)$, 这里面我们通过传统概率算法计数法来计算对应的概率, 具体如下:</p>
<ul>
<li>N个球放入N个盒子，不考虑球的差异性，其有 $\binom{2*n-1}{n}$ 可能性</li>
<li><p>再考虑如果最多盒子对应的球的个数为k的放法, 我们定义为$c(n_1,n_2,k)$, 表明$n_1$个球放入$n_2$盒子，最多的盒子里面有$k$个球的方法数,则显然有:</p>
<ul>
<li>$c(n,n,1)$ = 1</li>
<li>$c(n,n,n)$ = n</li>
</ul>
</li>
</ul>
<p>而对于$c(n,n,k)$我们则使用递归法统计， 我们可以估算其最多有$i$个盒子里面有$k$个球，基于次分析:</p>
<p>$$c(n_1,n_2,k) =  \sum_{i=1}^{n} (cc(i) <em> (\sum_{j=1}^{k-1}c(n_1-i</em>k,n_2-i, j)))$$</p>
<p>其中$cc(i)$ 表明$i$个盒子有$k$个球，选取的办法有$\binom{n_2}{i}$<br>而公示后半部分的意思是剩余的盒子里面，最多为1,2,…,k-1个球的放法</p>
<p>按照如上的公示，可以得到代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">s</span><span class="params">(ball,box,k)</span> :</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ball &gt; box <span class="keyword">and</span> k == <span class="number">1</span> :</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> box &gt; ball <span class="keyword">and</span> k == <span class="number">1</span> :</div><div class="line">        total = math.factorial(box) / math.factorial(ball) / math.factorial(box - ball)</div><div class="line">        <span class="keyword">return</span> total</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> ball == box <span class="keyword">and</span> k == <span class="number">1</span> :</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span></div><div class="line">    </div><div class="line">    <span class="keyword">if</span> k &lt;= <span class="number">0</span> :</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    </div><div class="line">    total = <span class="number">0</span></div><div class="line">    </div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,ball+<span class="number">1</span>) :</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> i * k &gt; ball :</div><div class="line">            <span class="keyword">break</span></div><div class="line">            </div><div class="line">        <span class="keyword">if</span> i &gt; box :</div><div class="line">            <span class="keyword">break</span></div><div class="line">        </div><div class="line">        tmp1 = math.factorial(box) / math.factorial(i) / math.factorial(box - i)</div><div class="line">        tmp2 = <span class="number">0</span></div><div class="line">        </div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>,k) :</div><div class="line">            tmp2 += s(ball- i*k, box-i, k-j)</div><div class="line">        total += tmp1 * tmp2</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> total</div></pre></td></tr></table></figure>
<p>依照如上公示，我们可以得到一些期望值如下:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ball_exp(<span class="number">10</span>) = <span class="number">3.7</span></div><div class="line">ball_exp(<span class="number">20</span>) = <span class="number">4.7</span></div><div class="line">ball_exp(<span class="number">40</span>) = <span class="number">5.6</span></div></pre></td></tr></table></figure></p>
<p>和上面的数据推导数据不完全一致，但是还是符合相应的函数曲线的</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><p><a href="https://fly.io/articles/simple-wins-power-of-2-load-balancing/" target="_blank" rel="external">When Simple Wins: The Power of Two Random Choices</a> : 介绍<code>Two-Random-Choices</code>在<code>fly.io</code>的应用</p>
</li>
<li><p><a href="http://liblb.com/p2c.html#experiment" target="_blank" rel="external">An Empirical Study of Load Balancing Algorithms</a> : 对<code>Two Random Choices</code>的深入介绍和说明</p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nginx/">nginx</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <article id="post-20180624" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/07/02/20180624/">weekly of 20180624</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/07/02/20180624/" class="article-date">
  <time datetime="2018-07-02T04:49:45.000Z" itemprop="datePublished">2018-07-02</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/images/hongkong.jpg" alt="香港"></p>
<h3 id="工具技巧"><a href="#工具技巧" class="headerlink" title="工具技巧"></a>工具技巧</h3><ul>
<li><p><a href="https://news.ycombinator.com/item?id=17363871" target="_blank" rel="external">Jsonnet – A data templating language | Hacker News</a> : Jsonnet是一个Json的模板语言，可以简单快速的构建基于Json的数据结构；PS: 其应用场景应该是作为中间工具，让业务用比较低的成本编写Json(支持计算/变量等)，然后转换成最终的Json，降低业务json的维护和改造成本, 但是感觉其学习成本也不低</p>
</li>
<li><p><a href="https://www.bleepingcomputer.com/news/security/changes-in-webassembly-could-render-meltdown-and-spectre-browser-patches-useless/" target="_blank" rel="external">Changes in WebAssembly Could Render Meltdown and Spectre Browser Patches Useless</a> : WebAssembly提供了一个能让程序更高效运行在浏览器的机制，但是也可能存在一些副作用，比如一旦引入类似于<code>multi-thread</code>的机制，就可能引入一些安全问题和风险, 比如之前CPU的Meltdown和Spectre漏洞</p>
</li>
</ul>
<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><ul>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;mid=2247491111&amp;idx=1&amp;sn=4dae1d28412e4a09e8cc56e3d35284cf" target="_blank" rel="external">独家揭秘：腾讯千亿级参数分布式ML系统无量背后的秘密</a> : 信息量很大，先mark，本周消化下</p>
</li>
<li><p><a href="https://blog.acolyer.org/2018/06/26/deep-code-search/" target="_blank" rel="external">Deep code search | the morning paper</a> : 挺有意思的一个系统，通过深度学习的方法来了解代码的大概功能，基于此，可以解决一些语义检索的问题，比如说”read an object from xml”, 可能有一天会取代<code>stack overflow</code></p>
</li>
<li><p><a href="https://khanna.cc/blog/structuring-deep-learning-projects/" target="_blank" rel="external">Structuring Deep Learning Projects</a> : 本文介绍一个架构化的深度学习项目的开展方式，具体包括: </p>
<ol>
<li>Pick a cost function.</li>
<li>Pick an initial network architecture.</li>
<li>Fit the training set well on the cost function.</li>
<li>Fit the validation set well on the cost function.</li>
<li>Verify performance on a test set.</li>
<li><p>Verify performance in the real world.</p>
<p>其实这也是普适的机器学习方法</p>
</li>
</ol>
</li>
</ul>
<h3 id="专题topic"><a href="#专题topic" class="headerlink" title="专题topic"></a>专题topic</h3><blockquote>
<p>About Perf Tool</p>
</blockquote>
<ul>
<li><p>选择工具: <a href="http://www.brendangregg.com/blog/2015-07-08/choosing-a-linux-tracer.html" target="_blank" rel="external">Choosing a Linux Tracer (2015)</a>  作者分享了自己如何选择trace的参考依据，结论是建议大部分情况可以优先考虑perf tool(系统默认支持，不过和系统版本相关性较大)</p>
</li>
<li><p>入门使用 :</p>
<ul>
<li><a href="https://perf.wiki.kernel.org/index.php/Tutorial" target="_blank" rel="external">Perf: Tutorial</a> : 入门了解</li>
<li><a href="http://www.brendangregg.com/perf.html" target="_blank" rel="external">Brendangregg: perf Examples</a> : 系统介绍</li>
</ul>
</li>
<li><p>机制原理 : </p>
<ul>
<li><a href="https://jvns.ca/blog/2016/03/12/how-does-perf-work-and-some-questions/" target="_blank" rel="external">How does perf work? (in which we read the Linux kernel source)</a></li>
<li><a href="https://news.ycombinator.com/item?id=11277172" target="_blank" rel="external">Hacker News Comment On How does perf work</a></li>
</ul>
</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;mid=2247491140&amp;idx=1&amp;sn=8849bce1ea612049a07f6406c244a771" target="_blank" rel="external">最强指南：处理35种不良数据的正确方式</a> : 一些处理数据的tips建议，可以关注的点包括<a href="https://zh.wikipedia.org/wiki/%E6%9C%AC%E7%A6%8F%E7%89%B9%E5%AE%9A%E5%BE%8B" target="_blank" rel="external">本福特定律</a>,<a href="https://www.quora.com/What-is-p-hacking" target="_blank" rel="external">结果被p-hack</a></p>
</li>
<li><p><a href="https://github.com/oddisland/Draft" target="_blank" rel="external">Draft:Online markdown editor</a> : 感觉是一个还不错的markdown在线编辑器</p>
</li>
<li><p><a href="https://pomax.github.io/bezierinfo/zh-CN/" target="_blank" rel="external">A Primer on Bézier Curves</a> : 进行mark</p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;mid=2247491127&amp;idx=1&amp;sn=9897b560cb0350e8ece0f61b3dc461c4" target="_blank" rel="external">这是我看过解释TensorFlow最透彻的文章！</a> : 继续mark</p>
</li>
<li><p><a href="https://github.com/Valloric/YouCompleteMe" target="_blank" rel="external">Valloric/YouCompleteMe: A code-completion engine for Vim</a> : A code-completion engine for Vim, 一个比较系统的代码补全工具的合集, 还可以参看<a href="https://ops.tips/gists/navigating-the-linux-kernel-source-with-youcompleteme/" target="_blank" rel="external">Navigating the Linux Kernel source tree with YouCompleteMe | OpsTips</a>这个的介绍说明</p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weekly/">weekly</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <article id="post-20180617" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/24/20180617/">weekly of 20180617</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/06/24/20180617/" class="article-date">
  <time datetime="2018-06-24T05:36:45.000Z" itemprop="datePublished">2018-06-24</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="工具技巧"><a href="#工具技巧" class="headerlink" title="工具技巧"></a>工具技巧</h3><ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzIzNjUxMzk2NQ==&amp;mid=2247489433&amp;idx=1&amp;sn=094e94e19baa62f7015dc1afd5c67576" target="_blank" rel="external">写好shell脚本的13个技巧</a> : 很多建议都非常中肯，有点琐碎，去能真正提供好用户体验, 具体如下(个人感觉最后有一个shell的lib自动提供如下的能力) :<ol>
<li>提供–help标记</li>
<li>检查所有命令的可用性</li>
<li>独立于当前工作目录</li>
<li>如何读取输入：环境变量 vs. 标记</li>
<li>打印对系统执行的所有操作</li>
<li>如果有必要，提供–silent选项</li>
<li>重新开启显示</li>
<li>用动画的方式显示进度</li>
<li>用颜色编码输出</li>
<li>出现错误立即退出脚本</li>
<li>自己执行清理工作</li>
<li>在退出时使用不同的错误码</li>
<li>在结束时打印一个新行</li>
</ol>
</li>
</ul>
<ul>
<li><p><a href="https://about.gitlab.com/2018/06/15/introducing-gitlab-s-integrated-development-environment/" target="_blank" rel="external">Meet the GitLab Web IDE</a> : 介绍Gitlab的web IDE背后设计的思路和发展历程，整体感觉集Web IDE集成在gitlab可以对开发流程提供的想象空间很大</p>
</li>
<li><p><a href="https://carbon.now.sh/" target="_blank" rel="external">Carbon</a> : “Create and share beautiful images of your source code”, 其可以生成渲染出好看的代码截图(不知道有什么用~)</p>
</li>
</ul>
<ul>
<li><a href="https://code.facebook.com/posts/1461914677288302/open-sourcing-sonar-a-new-extensible-debugging-tool/" target="_blank" rel="external">Open-sourcing Sonar, a new extensible debugging tool | Engineering Blog | Facebook Code</a> : Facebook发布的用于调试和追踪App行为的工具, 不过app事先嵌入相关的SDK，感觉有一定的成本</li>
</ul>
<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><ul>
<li><p><a href="https://memcached.org/blog/nvm-caching/" target="_blank" rel="external">Caching beyond RAM: the case for NVMe</a> : 本文提供了一个memcached的新的解决方案，通过<code>exstore</code>机制，将部分缓存的<code>value</code>数据存储在独立的存储引擎上面(比如SSD或者本文的NVMe存储介质)，数据表明，其性价比和性能还是非常可观的, 其中的<a href="https://github.com/memcached/memcached/wiki/Extstore" target="_blank" rel="external">Extstore</a>值得关注</p>
</li>
<li><p><a href="https://blog.twitter.com/engineering/en_us/topics/insights/2018/twittertensorflow.html" target="_blank" rel="external">Twitter meets TensorFlow</a> : mark, 介绍twitter的tensorflow的接入历程</p>
</li>
<li><p><a href="https://code.facebook.com/posts/605721433136474/accelerate-large-scale-applications-with-bolt/" target="_blank" rel="external">Accelerate large-scale applications with BOLT | Engineering Blog | Facebook Code</a> : 现在多数软件系统的体积都会很大，这可能会导致其不能被CPU cache命中，进而会导致诸如<a href="https://software.intel.com/en-us/vtune-amplifier-help-instruction-starvation" target="_blank" rel="external">Instruction Starvation</a>的问题,  所以<code>Binary Optimization and Layout Tool</code>就有一定的发展空间；本文介绍了Facebook的BOLT的解决方案, 其通过链接优化，profile采集进而进行二进制优化，来提升整体程序的性能，支持多种CPU架构和编译器，可以感觉Facebook在基础技术的优化做的还是非常精细的</p>
</li>
</ul>
<h3 id="专题topic"><a href="#专题topic" class="headerlink" title="专题topic"></a>专题topic</h3><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;mid=2247490909&amp;idx=1&amp;sn=cb8b69c0433c40b8d5e2ef0b9d2b58e2" target="_blank" rel="external">创业半年估值四亿！离开百度后他打造了中国版AutoML</a> : AutoML以后会是趋势，至少应该会有系统化或者成套的解决方案让机器学习工程师从调参等事情中解放出来</p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMzg1ODcwMw==&amp;mid=2247487968&amp;idx=1&amp;sn=2ff7b511f6727c7816ab02fc0e1c0361" target="_blank" rel="external">聊聊架构</a> :  不是特别喜欢行文风格，但是总结起来就是<code>如果你在使用 MySQL 或 MariaDB，不要用“utf8”编码，改用“utf8mb4”</code></p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;mid=2247490919&amp;idx=1&amp;sn=7df7d148c1d3907654980d39500c94bd" target="_blank" rel="external">重磅！Netflix开源大数据发现服务框架Metacat</a> : 个人之前有设想过需要去构建的大数据服务系统，其”旨在让发现、处理和管理数据变得更为方便”</p>
</li>
<li><p><a href="http://jamie-wong.com/post/reverse-engineering-instruments-file-format/" target="_blank" rel="external">Reverse Engineering Instruments’ File Format</a> : 内容比较多，先mark</p>
</li>
<li><p>[<a href="http://www.saminiir.com/lets-code-tcp-ip-stack-1-ethernet-arp/" target="_blank" rel="external">Let’s code a TCP/IP stack, 1: Ethernet &amp; ARP</a>] : mark</p>
</li>
<li><p><a href="http://www.pcg-random.org/" target="_blank" rel="external">PCG, A Family of Better Random Number Generators | PCG, A Better Random Number Generator</a> : Mark, 有个具体说明的video，有空的时候可以看下</p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weekly/">weekly</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <article id="post-20180610" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/06/24/20180610/">weekly of 20180610</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/06/24/20180610/" class="article-date">
  <time datetime="2018-06-24T05:34:45.000Z" itemprop="datePublished">2018-06-24</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="工具技巧"><a href="#工具技巧" class="headerlink" title="工具技巧"></a>工具技巧</h3><ul>
<li><p><a href="https://www.oschina.net/news/96686/side-channel-attacking-browsers" target="_blank" rel="external">令人惊叹的 CSS 漏洞攻击，Firefox 和 Chrome 中枪</a> :  文章介绍了一个比较精巧的用户隐私窃取方式, 可以关注其英文原文<a href="https://www.bleepingcomputer.com/news/security/css-is-so-overpowered-it-can-deanonymize-facebook-users/" target="_blank" rel="external">CSS Is So Overpowered It Can Deanonymize Facebook Users</a></p>
</li>
<li><p><a href="https://jasonhpriestley.com/lr" target="_blank" rel="external">LR Parsing: More Elegant Than You Think</a> : 对LR算法的更通俗，简单易懂的一个介绍</p>
</li>
<li><p><a href="http://dockone.io:82/article/5280" target="_blank" rel="external">gVisor：Google开源的新型沙箱容器运行时环境</a> : 谷歌发布了一款新型的沙箱容器运行时 gVisor，号称能够为容器提供更安全的隔离，同时比 VM 更轻量，其核心是希望补齐直接docker之类技术引入的安全性问题。沙箱的解决方案有多个，本文侧重介绍gVisor的实现机制，<a href="https://mp.weixin.qq.com/s?__biz=MzIzNjUxMzk2NQ==&amp;mid=2247489400&amp;idx=1&amp;sn=4f099bdfb41e046f430acb135d0817eb" target="_blank" rel="external">此文</a>有进一步的说明, 感觉虚拟化技术最近几年发展和变化速度非常迅猛</p>
</li>
</ul>
<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><ul>
<li><p><a href="https://techcrunch.com/2018/06/01/how-instagram-feed-works/" target="_blank" rel="external">How Instagram’s algorithm works | TechCrunch</a> : 本文介绍Instagram的新的排序算法，其相比于传统的基于回复时间排序的算法，对于文章的曝光率有了明显的提升，具体策略算法方面，只是介绍了一些核心的思路，细节之处没有做过多介绍，但是仍旧值得关注。 </p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMzg1ODcwMw==&amp;mid=2247487946&amp;idx=1&amp;sn=69a96352c28d95db1620537e9ac65587" target="_blank" rel="external">重新理解微服务</a> : 感觉相对来说比较干货的文章，具体介绍了业务服务化改造后可能面临的问题，以及其解决方案，重点介绍了”服务粒度”, “服务组合”, “数据一致性”, “支撑系统” 等一些基础设施以及能力在落地时候的关键点</p>
</li>
<li><p><a href="https://medium.com/netflix-techblog/the-end-of-video-coding-40cf10e711a2" target="_blank" rel="external">The End of Video Coding? – Netflix TechBlog – Medium</a> : 一个反问的标题，其实对视频的编码技术的优化需求从来没这么迫切，随着视频时代到来，如果在有效带宽上面提供更好的用户体验一直是各厂商的需求，作者踢了几点思路，感觉可以参考：</p>
<ul>
<li>Let’s innovate beyond block-based hybrid encoding</li>
<li>The community needs better ways to measure video quality</li>
<li>Encouraging new ideas means discussing with new people(这个忽略)</li>
</ul>
</li>
</ul>
<h3 id="专题topic"><a href="#专题topic" class="headerlink" title="专题topic"></a>专题topic</h3><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><p><a href="https://github.com/thosakwe/t2b" target="_blank" rel="external">thosakwe/t2b: A wicked-powerful text macro language for building binary files.</a> : 挺有意思的一个工具，通过描述性语言(DSL)快速生成一个二进制文件, 纯C实现~</p>
</li>
<li><p><a href="http://codebay.cn/post/9253.html" target="_blank" rel="external">Firefox 和 Tor 浏览器正进行整合，最终实现二合一 –</a> : 持续关注，后续希望无论在Chrome还是Firefox都有比较好的隐私浏览体验和保护</p>
</li>
<li><p><a href="https://weibo.com/5815864126/GjcIowhtU" target="_blank" rel="external">火币研究院最新发布的全球区块链产业全</a> : 对于区块链的近一年爆发式发展的一个概述，可以当做课外读物</p>
</li>
<li><p><a href="https://devpen.io/editor" target="_blank" rel="external">Devpen | Markdown Editor with GitHub Style</a> : 很简单精炼的Github样式支持的Markdowen编辑器</p>
</li>
<li><p>[<a href="https://jmperezperez.com/fostering-web-performance-culture/" target="_blank" rel="external">Fostering a Web Performance Culture - José M. Pérez</a>] : 很长的文章，介绍了作者对于如何构建一个对性能持续关注投入的团队，作者也提了自己的一些建议，包括:</p>
<ul>
<li>Your dev environment is not your user’s environment(Realistic environment)</li>
<li>It’s better to learn the fundamentals than the library (Fundamentals over libraries)</li>
<li>Get the time to experiment and validate (Experiment on your project)</li>
<li>Educate your Colleagues </li>
<li>Share and celebrate success (and failure) stories (Share &amp; Celebrate)</li>
<li>Make performance part of your workflow(Integrate in workflow)</li>
</ul>
</li>
<li><p><a href="https://medium.com/@CanHasCommunism/understanding-compilers-for-humans-ba970e045877" target="_blank" rel="external">Understanding Compilers</a> : 干货很少，但是可以学习如何用简单的语言去描述一个负责的编译过程，包括”the major concepts in compilers like tokenization, grammars, parsing, and code generation”</p>
</li>
<li><p><a href="http://blog.jamesdbloom.com/JVMInternals.html" target="_blank" rel="external">JVM Internals</a> : 关于JVM实现机制的介绍，内容没有细看，不过排版和图片非常赞，另外作者的blog的干货也是非常多，mark关注下</p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMzg1ODcwMw==&amp;mid=2247487964&amp;idx=1&amp;sn=dc8ed665b9fd684cc6f99cae09feb4ab" target="_blank" rel="external">如何防止密码被硬编码到代码中？Yelp开源了自己的解决方案</a> :  一个很简单的文章，Yelp开源了自己代码密码检测的工具，如果检测代码里面是否有密码呢？思路很简单，就是通过计算内容的<a href="http://blog.dkbza.org/2007/05/scanning-data-for-entropy-anomalies.html" target="_blank" rel="external"> Shannon entropy formula</a>, 如果信息熵越大，那就说明其是密码的概率就越高，关于其进一步介绍可以参看<a href="http://www.bearcave.com/misl/misl_tech/wavelets/compression/shannon.html" target="_blank" rel="external">Shannon Entropy
</a></p>
</li>
<li><p><a href="https://weibo.com/ttarticle/p/show?id=2309404250830327963644" target="_blank" rel="external">10 款程序员必备的免费开源安全工具，助你成为极客</a> : mark，关注</p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weekly/">weekly</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <article id="post-20180520" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/22/20180520/">weekly of 20180520</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/05/22/20180520/" class="article-date">
  <time datetime="2018-05-22T03:15:45.000Z" itemprop="datePublished">2018-05-22</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="工具技巧"><a href="#工具技巧" class="headerlink" title="工具技巧"></a>工具技巧</h3><ul>
<li><p><a href="https://ripe76.ripe.net/presentations/10-2018-05-15-bbr.pdf" target="_blank" rel="external">2018-05-16-bbr</a> : 对TCP的BBR的拥塞机制的系统介绍和说明</p>
</li>
<li><p><a href="https://github.com/Troland/how-javascript-works/blob/master/webassembly.md" target="_blank" rel="external">How JavaScript works: A comparison with WebAssembly + why in certain cases it’s better to use it over JavaScript</a> : 比较精炼的介绍了Web Assembly相比于Javascript的优势，以及其实现机制，一些配图都挺赞的, 而且blog里面的<code>How Javascript works</code>也挺赞的，可以关注 </p>
</li>
<li><p><a href="http://www.maizure.org/projects/printf/index.html" target="_blank" rel="external">Tearing apart printf() – MaiZure’s Projects</a> : 一个简单的<code>printf</code>的调用其底层实现机制具体的怎么样的呢? 作者通过strace/gdb等一系列工具，详细说明了<code>printf</code>实现机制，包括静态/动态链接是，其在C标准库, 系统调用方面的情况, 是很好的了解系统编译，链接机制的教材</p>
</li>
<li><p><a href="http://www.pixelbeat.org/programming/stdio_buffering/" target="_blank" rel="external">stdio buffering</a> : 文章介绍，在Shell环境下，由于输入/输出，pipe都会有一定的内存buffer, 可能会导致一些程序有非预期行为(输出不及时等)，其通过图例直观的展示了buffer的影响，同时概述的介绍一些linux后续可以考虑采纳的方案，比如通过引入<code>BUF_1</code>的环境变量, 引入<code>stdbuf</code>等命令</p>
</li>
</ul>
<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><ul>
<li><a href="https://developers.google.com/machine-learning/rules-of-ml/" target="_blank" rel="external">机器学习规则 (Rules of Machine Learning)</a> :  Google Developer网站推荐的机器学习落地实践的方法，个人觉得非常有参考价值</li>
</ul>
<h3 id="专题topic"><a href="#专题topic" class="headerlink" title="专题topic"></a>专题topic</h3><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><p><a href="http://www.themtank.org/a-year-in-computer-vision" target="_blank" rel="external">A Year in Computer Vision</a> : 对于计算机视觉过去一年的进展的概述，值得学习review</p>
</li>
<li><p><a href="http://www.webhek.com/post/utmurchin-tracking-module-with-google-analytics.html" target="_blank" rel="external">使用UTM(Urchin Tracking Module)统计流量来源 – WEB骇客</a> : Google Analysis的提供的基于querystring的站点统计和分析的解决方案</p>
</li>
<li><p><a href="https://news.ycombinator.com/item?id=17107149" target="_blank" rel="external">A Formal Security Analysis of the Signal Messaging Protocol (2017)</a> : 对支持E2E的加密软件/算法<code>Signal</code>协议的深入剖析, hacker news上面相关的评论和总结还不错</p>
</li>
<li><p><a href="http://pgbovine.net/cpython-internals.htm" target="_blank" rel="external">CPython internals: A ten-hour codewalk through the Python interpreter source code</a> : 通过视频录制/讲解的方式让你对Cpython的整体机制有进一步的了解, mark</p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weekly/">weekly</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <article id="post-20180513" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/22/20180513/">weekly of 20180413</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/05/22/20180513/" class="article-date">
  <time datetime="2018-05-22T03:13:45.000Z" itemprop="datePublished">2018-05-22</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="工具技巧"><a href="#工具技巧" class="headerlink" title="工具技巧"></a>工具技巧</h3><ul>
<li><p><a href="https://blogs.msdn.microsoft.com/commandline/2018/05/08/extended-eol-in-notepad/" target="_blank" rel="external">Introducing extended line endings support in Notepad</a> : “Starting with the current Windows 10 Insider build, Notepad will support Unix/Linux line endings (LF), Macintosh line endings (CR), and Windows Line endings (CRLF) as usual”</p>
</li>
<li><p><a href="https://software.rajivprab.com/2018/04/29/myths-programmers-believe-about-cpu-caches/" target="_blank" rel="external">Myths Programmers Believe about CPU Caches – Software the Hard way</a> : 本文具体介绍了CPU内部的cache和main memory数据一致性的问题和解决方案，其本质设计里面和分布式系统的数据一致性思路雷同，核心思路是基于<a href="https://en.wikipedia.org/wiki/MESI_protocol" target="_blank" rel="external">MESI protocol</a>在硬件层面的实现</p>
</li>
<li><p><a href="https://techcrunch.com/2018/05/07/microsofts-new-intellicode-is-a-smarter-intellisense/" target="_blank" rel="external">Microsoft’s new IntelliCode is a smarter IntelliSense</a> : VS Studio通过AI提供更智能的代码提示, 希望后续微软能够披露里面的技术实现机制和细节，便于迁移更多的产品和应用, 这个和Google IO展示的<a href="https://www.businessinsider.sg/google-gmail-gets-smart-compose-automatic-reply-suggestion-service-2018-5/" target="_blank" rel="external">Google wants Gmail to help reply to your emails for you with this new AI tech, Business Insider</a> 思路有点类似，可见后续越来越多的人工智能会应用用这些看起来琐碎，却是重复的一些工作上面</p>
</li>
</ul>
<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><ul>
<li><a href="https://cacm.acm.org/magazines/2018/4/226371-lessons-from-building-static-analysis-tools-at-google/fulltext" target="_blank" rel="external">Lessons from Building Static Analysis Tools at Google</a> : 文章比较长，先mark关注下</li>
</ul>
<ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;mid=2247490326&amp;idx=1&amp;sn=21126be3c5ea7d112dfacf21c9f87128&amp;chksm=fbe9a2d9cc9e2bcfd7c6284be84898d911f7f1e6e04807f3562debc913cd89f32dd1037b72fb#rd" target="_blank" rel="external">给你打电话的可能不是人！谷歌Duplex颠覆智能助手</a> : Google IO是这周科技界的热门事件，本文介绍了其<code>Google Assistant</code>的特性以及其背后的技术支持情况</li>
</ul>
<h3 id="专题topic"><a href="#专题topic" class="headerlink" title="专题topic"></a>专题topic</h3><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><p><a href="http://blog.scottlogic.com/2018/04/26/webassembly-by-hand.html" target="_blank" rel="external">Writing WebAssembly By Hand</a> : </p>
</li>
<li><p><a href="https://weibo.com/ttarticle/p/show?id=2309404212049503760281#_0" target="_blank" rel="external">周鸿祎：写区块链最好的一篇文章</a> : mark了解下</p>
</li>
<li><p><a href="http://codebay.cn/post/8960.html" target="_blank" rel="external">最适合练手30个的机器学习开源项目，赶紧收藏</a> : mark下，后续可以试试里面的一些项目 </p>
</li>
<li><p><a href="http://www.techug.com/post/how-cpu-make-out.html" target="_blank" rel="external">CPU是如何制造出来的（附高清全程图解</a> : </p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s/lCQxGFPvzLPyXm0ttGtIkA" target="_blank" rel="external">理解共识算法真谛，让你不再被忽悠</a> : 介绍的清晰明了，可以对共识算法有个初步的认识和理解</p>
</li>
<li><p><a href="http://www.ruanyifeng.com/blog/2018/05/root-domain.html" target="_blank" rel="external">根域名的知识 - 阮一峰的网络日志</a> : 科普短文</p>
</li>
<li><p><a href="http://norvig.com/21-days.html" target="_blank" rel="external">Teach Yourself Programming in Ten Years</a> : 对于学习成长的具体方法说的很具体很契合实际，包括”Learn at least a half dozen programming languages. Include one language that emphasizes class abstractions (like Java or C++), one that emphasizes functional abstraction (like Lisp or ML or Haskell), one that supports syntactic abstraction (like Lisp), one that supports declarative specifications (like Prolog or C++ templates), and one that emphasizes parallelism (like Clojure or Go)”，对于Lisp之类的语言后续还是需要再投入学习</p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weekly/">weekly</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <article id="post-20180506" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/07/20180506/">weekly of 20180505</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2018/05/07/20180506/" class="article-date">
  <time datetime="2018-05-07T04:53:45.000Z" itemprop="datePublished">2018-05-07</time>
</a>
      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/images/yanqing01.jpg" alt="延庆"></p>
<h3 id="工具技巧"><a href="#工具技巧" class="headerlink" title="工具技巧"></a>工具技巧</h3><ul>
<li><p><a href="https://zinovyev.net/blog/ssh-client-configuration-tricks" target="_blank" rel="external">SSH client configuration tricks</a> : 关于SSH的使用技巧, 可以对特定机器设定alias, 并且绑定相关配置, 对于常见的VPS可以做这类的优化</p>
</li>
<li><p><a href="https://opensource.com/article/18/4/cpu-utilization-wrong" target="_blank" rel="external">CPU utilization is wrong, says Netflix’s Brendan Gregg</a> : 关于CPU优化的深入讨论, 其实强调的核心理念是，现在CPU和内存的速度越差越大，所以有时候会我们发现CPU idle很低的时候，有可能其并不是在忙着执行指令，而是在等待Memory IO，尤其是高速缓存失效的时候</p>
</li>
<li><p><a href="https://onlinebinarytools.com/" target="_blank" rel="external">online binary tools</a> : 一些online bianry的工具集合, 有兴趣可以关注下。不过个人更喜欢用类似于<a href="https://zeppelin.apache.org/" target="_blank" rel="external">Zeppelin</a>通过此类的平台，来构建自己的工具集</p>
</li>
<li><p><a href="http://blog.pengqiuyuan.com/ji-chu-jie-shao-ji-suo-yin-yuan-li-fen-xi/" target="_blank" rel="external">Elasticsearch－基础介绍及索引原理分析</a> : 对ES的索引和存储架构有比较详细的说明，可以快速了解下</p>
</li>
<li><p><a href="https://github.com/google/randen" target="_blank" rel="external">google/randen: Fast backtracking-resistant random generator</a> : “What if we could default to attack-resistant random generators without excessive CPU cost? We introduce ‘Randen’, a new generator with security guarantees; it outperforms MT19937 and pcg64_c32 in real-world benchmarks. This is made possible by AES hardware acceleration and a large Feistel permutation.”， Google提出的新的随机数生成器，不过对其要解决的问题和解决的方案并不是很了解，先mark</p>
</li>
</ul>
<h3 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h3><ul>
<li><p><a href="https://groups.csail.mit.edu/mac/users/gjs/6.945/readings/robust-systems.pdf" target="_blank" rel="external">robust-systems.pdf</a> : mark</p>
</li>
<li><p><a href="https://www.oschina.net/news/95719/google-chrome-will-show-warnings-for-non-logged-ssl-certificates" target="_blank" rel="external">谷歌访问非登记SSL证书的HTTPS网站将全屏警告</a> : “自今天开始，访问尚未在公共证书透明度（CT）日志中登记 SSL 证书的 HTTPS 网站，Chrome 浏览器将会显示全屏警告。这样做使 Chrome 浏览器成为首个部署支持 Certificate Transparency Log 策略的浏览器”, 如果有关注之前介绍的TLS的文章，可以认为<a href="https://www.certificate-transparency.org/" target="_blank" rel="external">Certificate Transparency</a>是解决CT恶意或者无意颁发错误证书的一个有效办法</p>
</li>
<li><p><a href="https://www.ebayinc.com/stories/blogs/tech/elasticsearch-performance-tuning-practice-at-ebay/" target="_blank" rel="external">Elasticsearch Performance Tuning Practice at eBay</a> :  本文是eBay分享的关于ES使用优化的一系列建议，包括<code>优化索引设计</code>, <code>优化检索query</code>，<code>性能评估</code>等多个阶段多个方面的具体实践建议, 也有中文版<a href="http://www.infoq.com/cn/articles/elasticsearch-performance-tuning-practice-at-ebay" target="_blank" rel="external">eBay的Elasticsearch性能调优实践</a></p>
</li>
</ul>
<h3 id="专题topic"><a href="#专题topic" class="headerlink" title="专题topic"></a>专题topic</h3><blockquote>
<p>这两周主要关注WebAssembly，在整理相关的文章~</p>
</blockquote>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><p><a href="https://dendibakh.github.io/blog/2018/04/22/What-optimizations-you-can-expect-from-CPU" target="_blank" rel="external">What optimizations you can expect from CPU?</a> : Mark</p>
</li>
<li><p><a href="http://www.techug.com/post/27-incredibly-useful-things-you-didnt-know-chrome-could-do.html" target="_blank" rel="external">超好用的27个谷歌Chrome浏览器使用技巧</a> : 一些Chrome使用的技巧，可以推荐的包括: <code>Cmd+Shift+T</code>恢复最近关闭的标签, <code>Chrome作为你的文件浏览</code>等</p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&amp;mid=2247489971&amp;idx=1&amp;sn=f9b023413f17576c0e859e1f12c3c5fb&amp;chksm=fbe9a07ccc9e296a24891063cb92c4ecbdee984985f9c9afcc1691748d7ea4c483bd96dc5540#rd" target="_blank" rel="external">苹果、谷歌等大厂的AI面试题被我们搞到手了，你敢来挑战吗？</a> : 有空锻炼下自己也挺好的~</p>
</li>
<li><p><a href="https://mp.weixin.qq.com/s/ZY0S6V3gOMJ9MNomHJCGQw" target="_blank" rel="external">没有真实，区块链不可篡改有毛用</a> : 比较赞同的一个文章，区块链的核心价值是需要记录真是的信息，然后不被篡改；但是前者才是真正的难题，也很难想明白现在的不可篡改的存储机制对现有的业务流程有深层次改善的地方</p>
</li>
<li><p><a href="http://www.techug.com/post/machine-learning-study-list.html" target="_blank" rel="external">牛人的Machine Learning 机器学习笔记目录</a> : ML的学习比较, mark</p>
</li>
<li><p><a href="https://asylo.dev/" target="_blank" rel="external">Asylo</a> : Google发布的可信计算的框架，支持在云端部署含有私密数据的应用；直观而言，这个方面的需求在技术方面实现难度还比较大，先mark，下来深入学习</p>
</li>
</ul>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weekly/">weekly</a></li></ul>

      </footer>
    
  </div>
  
</article>








    
      <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
      </nav>
    </section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 shevacjs&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    
<script>
  var disqus_shortname = 'shevacjs-com';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>